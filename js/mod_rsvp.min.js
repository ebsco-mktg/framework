var RSVP=function(pub){function updateNoteField($rsvpForm){var $theFields=$rsvpForm.find("input").add("textarea").add("select").not(":hidden").not(":submit"),fieldLength=$theFields.length,$rsvpNoteField=$rsvpForm.find('[name="rsvp_notes"]'),rsvpNoteValue="",rsvpNoteString="Notes: "+rsvpNoteValue,lbStr="<br />\n",i=0;for(;i<fieldLength;i++){var $thisField=$theFields.eq(i),thisName=$thisField.attr("name"),thisValue=$thisField.val();rsvpNoteString=rsvpNoteString+lbStr+thisName+": "+thisValue}$rsvpNoteField.val(rsvpNoteString)}function updateUserFields(fieldItem){var fieldValue=$(fieldItem).val();fieldName=$(fieldItem).attr("name").slice(8);$("#"+fieldName).val(fieldValue)}function updateProfile(callback){var shouldUpdate=$("#update").is(":checked");if(shouldUpdate){var $profileFields=$('#fnRSVP [name^="profile_"]'),i=0,profileFieldsLength=$profileFields.length;for(;i<profileFieldsLength;i++){var thisFieldItem=$profileFields.eq(i);updateUserFields(thisFieldItem)}var $userForm=$("#memberForm");var thisRequest=$.ajax({url:$userForm.attr("action"),type:$userForm.attr("method"),data:$userForm.serialize()});thisRequest.fail(function(jqXHR,textStatus){window.console&&console.error("Request failed: "+textStatus)});thisRequest.done(function(jqXHR,textStatus){if(callback&&typeof callback==="function"){callback.apply(this,arguments)}})}else{if(callback&&typeof callback==="function"){callback.apply(this,arguments)}}}pub.init=function(){EIS.loadOnce("jQuery",function(){var $rsvpForm=$("#fnRSVP form"),thisError=0,regMsg=document.getElementById("regMsg");EIS.loadScript("//www.ebsco.com/apps/global/ada/js/source/mod_validate.js",function(){VALIDATE.init(false,{countryField:"#profile_country",stateField:"#profile_state",postalField:"#profile_postalcode"})});if($rsvpForm.length>0){var notesText=$rsvpForm.find("#rsvp_notes").val().replace(/\n/g,""),notesEmailText=$rsvpForm.find("#rsvp_notes").val().replace(/<br \/>/g,""),notesArr=notesText.split("<br />"),notesArrLength=notesArr.length,i=0;if(notesArrLength>1){$(regMsg).removeClass("hidden")}for(;i<notesArrLength;i++){var thisFieldArr=notesArr[i].split(": "),thisFieldName=thisFieldArr[0],thisFieldValue=thisFieldArr[1];if($("#events.thank-you-page .basic-list").length>0){var msgIntro="You are now registered for the following event: \n\n";var helpMsg="\n\n\nYou may update your registration by returning to "+$("#regReturnUrl").text();var theMsg=msgIntro+$("#eventDetailRaw").text()+notesEmailText+helpMsg;$("#message").val(theMsg);$("#"+thisFieldName).text(thisFieldValue)}else{if(thisFieldName!=="email"){if($("#"+thisFieldName).parent(".field").hasClass("select")){$("#"+thisFieldName).find('option[value="'+thisFieldValue+'"]').attr("selected","selected")}else{$("#"+thisFieldName).val(thisFieldValue)}}}}if($("#events.thank-you-page").length>0){var $contactForm=$("#contact_form");var thisRequest=$.ajax({url:$contactForm.attr("action"),type:$contactForm.attr("method"),data:$contactForm.serialize()});thisRequest.fail(function(jqXHR,textStatus){window.console&&console.error("Request failed: "+textStatus)});thisRequest.done(function(jqXHR,textStatus){})}$('input[name="rsvp_submit"]').on("click",function(evt){evt.preventDefault();thisError=VALIDATE.testfields();if(thisError!==0){VALIDATE.testfields();PROGRESS.setNavBtns();return false}else{$(this).addClass("loading");$("body").css("cursor","progress");updateNoteField($rsvpForm);updateProfile(function(){$rsvpForm.submit()})}});$('input[name="rsvp_cancel"]').on("click",function(evt){var thisResponse=window.confirm("Click 'OK' to delete your registration.");if(thisResponse){return true}else{return false}})}})};return pub}(RSVP||{});